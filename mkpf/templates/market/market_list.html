{% extends 'new_template.html' %}

{% block style %}
tbody tr:hover{
background-color: #20c997;
color:white;
opacity:0.7;

}

{% endblock %}


{% block content %}
<section class="property-details-section">

    <div class="container" style="margin-top:60px;">
        <div class="row">
            <div class="col-lg-12">
                {% include "success.html" %}
                <div class="section-title">
                    <h4>마켓 시세 조회</h4>
                </div>
                <div class="pd-text">

                        <div class="row justify-content-between my-3">
                            <div class="col-2">
                                <select class="form-control so">
                                    <option value="recent" {% if so=='recent' %}selected{% endif %}>최신순</option>
                                    <option value="expensive" {% if so=='expensive' %}selected{% endif %}>가격순</option>
                                    <option value="popular" {% if so=='popular' %}selected{% endif %}>사이즈순</option>
                                </select>
                            </div>
                            <div class="col-4 input-group" >
                                <input type="text"  class="form-control kw" onkeyup="enterkey();" value="{{ kw or '' }} ">
                                <div class="input-group-append">
                                    <button class="form-control btn btn-outline-secondary" type="button" id="btn_search">찾기</button>
                                </div>
                            </div>
                        </div>

                    <div class="table-responsive-md">

                        <table class="table table-bordered">
                            <thead style="background-color:#20c997;">
                            <tr align="center" style="color:white;">
                                <th scope="col">No.</th>
                                <th scope="col">Size</th>
                                <th scope="col">Condition</th>
                                <th scope="col">Title</th>
                                <th scope="col">Price</th>
                                <th scope="col">Date</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% if shoes_list %}

                            {% for shoes in shoes_list.items %}
                            <tr align="center" class="font-weight-normal">
                                <th scope="row">{{ shoes_list.total - ((shoes_list.page-1) * shoes_list.per_page) - loop.index0 }}</th>
                                <td>{{shoes.size}}</td>
                                <td>{{shoes.condition}}</td>
                                <td><input class="text-center" type="text" readonly disabled value="{{shoes.title}}"></td>
                                <td>{{shoes.price |price}}</td>
                                <td>{{shoes.upload_date|datetime}}</td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="3">데이터가 없습니다.</td>
                            </tr>
                            {% endif %}

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 페이징처리 시작 -->
            <div class="col-lg-12">
                <div class="property-pagination">
                <ul class="pagination justify-content-center thead-dark">
                    <!-- 이전페이지 -->
                    {% if shoes_list.has_prev %}
                        <a class="page-links icon" data-page="{{ shoes_list.prev_num }}" href="#"><span class="arrow_left"></span></a>
                    {% else %}
                    <span class="disabled">
                        <a class="page-links icon" tabindex="-1" aria-disabled="true" href="#"><span class="arrow_left"></span></a>
                    </span>
                    {% endif %}
                    {% for page_num in shoes_list.iter_pages() %}
                    {% if page_num %}
                    {% if page_num != shoes_list.page %}
                        <a class="page-links" data-page="{{ page_num }}" href="#">{{ page_num }}</a>
                    {% else %}
                    <span class="active" aria-current="page">
                        <a class="page-links" style="background-color: #20c997;color:white;" href="#">{{ page_num }}</a>
                    </span>
                    {% endif %}
                    {% else %}
                    <span class="disabled">
                        <a class="page-links" href="#">...</a>
                    </span>
                    {% endif %}
                    {% endfor %}
                    <!-- 다음페이지 -->
                    {% if shoes_list.has_next %}
                        <a class="page-links icon" data-page="{{ shoes_list.next_num }}" href="#"><span class="arrow_right"></span></a>
                    {% else %}
                    <span class="disabled">
                        <a class="page-links icon" tabindex="-1" aria-disabled="true" href="#"><span class="arrow_right"></span></a>
                    </span>
                    {% endif %}
                </ul>

                <!-- 페이징처리 끝 -->
            </div>
                </div>
        </div>
    </div>

    <form id="searchForm" method="get" action="{{ url_for('market._list') }}">
        <input type="hidden" id="kw" name="kw" value="{{ kw or '' }}">
        <input type="hidden" id="page" name="page" value="{{ page }}">
        <input type="hidden" id="so" name="so" value="{{ so }}">
    </form>
</section>
<!-- Property Section End -->
{% endblock %}

{% block script%}
<script type='text/javascript'>

// <![CDATA[
           function loading(){
               alert("데이터를 찾으시겠습니까?");
               $("#loading").show();
               $("#content").hide();
           }
// ]]>


function enterkey() {
        if (window.event.keyCode == 13) {
             // 엔터키가 눌렸을 때 실행할 내용
             btn_search.click();
        }
}


$(document).ready(function(){
    $(".page-links").on('click', function() {
        $("#page").val($(this).data("page"));
        $("#searchForm").submit();
    });
    $("#btn_search").on('click', function() {
        $("#kw").val($(".kw").val());
        $("#page").val(1);  // 검색버튼을 클릭할 경우 1페이지부터 조회한다.
        $("#searchForm").submit();
    });
    $(".so").on('change', function() {
        $("#so").val($(this).val());
        $("#page").val(1);
        $("#searchForm").submit();
    });

});
</script>
{% endblock %}
